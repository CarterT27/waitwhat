import{r as n,j as e,R as K,u as V,a as z,c as v}from"./main-D9T9K9KV.js";import{a as y,L as E}from"./loader-circle-6RTZhKqC.js";import{c as A}from"./clsx-B-dksMZM.js";import{c as S}from"./createLucideIcon-ufO4wm03.js";import{M as G,i as O,u as H,P as B,a as X,b as Y,L as Z,U as J,m as N}from"./proxy-3tB_AP7q.js";const ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],te=S("circle-alert",ee);const se=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ne=S("circle-check",se);const re=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],ie=S("message-circle",re);const oe=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ae=S("send",oe);const le=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],P=S("sparkles",le);const ce=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],de=S("thumbs-up",ce);function Q(t,r){if(typeof t=="function")return t(r);t!=null&&(t.current=r)}function ue(...t){return r=>{let s=!1;const o=t.map(l=>{const i=Q(l,r);return!s&&typeof i=="function"&&(s=!0),i});if(s)return()=>{for(let l=0;l<o.length;l++){const i=o[l];typeof i=="function"?i():Q(t[l],null)}}}}function me(...t){return n.useCallback(ue(...t),t)}class fe extends n.Component{getSnapshotBeforeUpdate(r){const s=this.props.childRef.current;if(s&&r.isPresent&&!this.props.isPresent){const o=s.offsetParent,l=O(o)&&o.offsetWidth||0,i=this.props.sizeRef.current;i.height=s.offsetHeight||0,i.width=s.offsetWidth||0,i.top=s.offsetTop,i.left=s.offsetLeft,i.right=l-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function he({children:t,isPresent:r,anchorX:s,root:o}){const l=n.useId(),i=n.useRef(null),f=n.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:g}=n.useContext(G),w=t.props?.ref??t?.ref,u=me(i,w);return n.useInsertionEffect(()=>{const{width:h,height:d,top:c,left:a,right:x}=f.current;if(r||!i.current||!h||!d)return;const m=s==="left"?`left: ${a}`:`right: ${x}`;i.current.dataset.motionPopId=l;const b=document.createElement("style");g&&(b.nonce=g);const R=o??document.head;return R.appendChild(b),b.sheet&&b.sheet.insertRule(`
          [data-motion-pop-id="${l}"] {
            position: absolute !important;
            width: ${h}px !important;
            height: ${d}px !important;
            ${m}px !important;
            top: ${c}px !important;
          }
        `),()=>{R.contains(b)&&R.removeChild(b)}},[r]),e.jsx(fe,{isPresent:r,childRef:i,sizeRef:f,children:n.cloneElement(t,{ref:u})})}const xe=({children:t,initial:r,isPresent:s,onExitComplete:o,custom:l,presenceAffectsLayout:i,mode:f,anchorX:g,root:w})=>{const u=H(pe),h=n.useId();let d=!0,c=n.useMemo(()=>(d=!1,{id:h,initial:r,isPresent:s,custom:l,onExitComplete:a=>{u.set(a,!0);for(const x of u.values())if(!x)return;o&&o()},register:a=>(u.set(a,!1),()=>u.delete(a))}),[s,u,o]);return i&&d&&(c={...c}),n.useMemo(()=>{u.forEach((a,x)=>u.set(x,!1))},[s]),n.useEffect(()=>{!s&&!u.size&&o&&o()},[s]),f==="popLayout"&&(t=e.jsx(he,{isPresent:s,anchorX:g,root:w,children:t})),e.jsx(B.Provider,{value:c,children:t})};function pe(){return new Map}const I=t=>t.key||"";function T(t){const r=[];return n.Children.forEach(t,s=>{n.isValidElement(s)&&r.push(s)}),r}const U=({children:t,custom:r,initial:s=!0,onExitComplete:o,presenceAffectsLayout:l=!0,mode:i="sync",propagate:f=!1,anchorX:g="left",root:w})=>{const[u,h]=X(f),d=n.useMemo(()=>T(t),[t]),c=f&&!u?[]:d.map(I),a=n.useRef(!0),x=n.useRef(d),m=H(()=>new Map),b=n.useRef(new Set),[R,F]=n.useState(d),[k,_]=n.useState(d);Y(()=>{a.current=!1,x.current=d;for(let j=0;j<k.length;j++){const p=I(k[j]);c.includes(p)?(m.delete(p),b.current.delete(p)):m.get(p)!==!0&&m.set(p,!1)}},[k,c.length,c.join("-")]);const L=[];if(d!==R){let j=[...d];for(let p=0;p<k.length;p++){const C=k[p],M=I(C);c.includes(M)||(j.splice(p,0,C),L.push(C))}return i==="wait"&&L.length&&(j=L),_(T(j)),F(d),null}const{forceRender:W}=n.useContext(Z);return e.jsx(e.Fragment,{children:k.map(j=>{const p=I(j),C=f&&!u?!1:d===k||c.includes(p),M=()=>{if(b.current.has(p))return;if(b.current.add(p),m.has(p))m.set(p,!0);else return;let $=!0;m.forEach(D=>{D||($=!1)}),$&&(W?.(),_(x.current),f&&h?.(),o&&o())};return e.jsx(xe,{isPresent:C,initial:!a.current||s?void 0:!1,custom:r,presenceAffectsLayout:l,mode:i,root:w,onExitComplete:C?void 0:M,anchorX:g,children:j},p)})})};function Ce(){const{sessionId:t}=K.useParams(),r=V(),[s,o]=n.useState(null),[l,i]=n.useState(!1),f=z(y.sessions.keepAlive);n.useEffect(()=>{const m=localStorage.getItem(`studentId-${t}`)||sessionStorage.getItem(`studentId-${t}`);m&&o(m),i(!0)},[t]),n.useEffect(()=>{l&&!s&&r({to:"/join"})},[l,s,r]),n.useEffect(()=>{if(!s||!t)return;f({sessionId:t,studentId:s});const m=setInterval(()=>{f({sessionId:t,studentId:s})},2e4);return()=>clearInterval(m)},[s,t,f]);const g=v(y.sessions.getSession,{sessionId:t}),w=v(y.transcripts.listTranscript,{sessionId:t}),u=v(y.quizzes.getActiveQuiz,{sessionId:t}),h=v(y.sessions.getStudentState,s?{sessionId:t,studentId:s}:"skip"),d=v(y.sessions.getStudentCount,{sessionId:t}),c=v(y.questions.listRecentQuestions,{sessionId:t,studentId:s??void 0}),a=z(y.sessions.setLostStatus);if(!g)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-4 border-ink border-t-transparent rounded-full animate-spin"})});if(g.status==="ended")return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-[2rem] shadow-comic border-2 border-ink text-center max-w-md w-full",children:[e.jsx("div",{className:"w-20 h-20 bg-mustard/20 rounded-full flex items-center justify-center mx-auto mb-6 border-2 border-ink",children:e.jsx(ne,{className:"w-10 h-10 text-ink"})}),e.jsx("h1",{className:"text-2xl font-black mb-2",children:"That's a wrap!"}),e.jsx("p",{className:"text-slate-500 font-bold",children:"The lecture has ended. Great work today."})]})});const x=async()=>{if(s){const m=!h?.isLost;await a({sessionId:t,studentId:s,isLost:m})}};return e.jsxs("div",{className:"min-h-screen bg-lavender-bg flex flex-col relative overflow-hidden",children:[e.jsx(U,{children:u&&s&&e.jsx(we,{quiz:u,studentId:s})}),e.jsxs("div",{className:"flex-1 max-w-2xl mx-auto w-full p-4 pb-32 flex flex-col gap-6",children:[e.jsxs("header",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"bg-white border-2 border-ink rounded-full px-4 py-2 shadow-comic-sm flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-coral rounded-full animate-pulse border border-ink"}),e.jsx("span",{className:"font-bold text-sm tracking-wide",children:"LIVE"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"bg-white border-2 border-ink rounded-xl px-4 py-2 shadow-comic-sm flex items-center gap-2 font-bold min-w-[100px] justify-center",children:[e.jsx(J,{className:"w-5 h-5 text-ink"}),e.jsx("span",{children:d??"..."})]}),e.jsxs("div",{className:"font-mono font-bold text-ink/50 text-sm",children:["#",g.code]})]})]}),e.jsx("div",{className:"flex-1 min-h-0 flex flex-col gap-4",children:e.jsx(be,{transcript:w??[]})})]}),e.jsx("div",{className:"fixed bottom-24 right-6 z-20",children:e.jsxs(N.button,{animate:h?.isLost?{scale:[1,1.1,1],rotate:[0,-5,5,-5,5,0],transition:{repeat:1/0,duration:.5}}:{},onClick:x,className:A("w-20 h-20 rounded-full shadow-comic flex items-center justify-center text-white border-2 border-ink active:shadow-comic-sm transition-all relative overflow-hidden group hover:translate-x-1 hover:translate-y-1 hover:shadow-none",h?.isLost?"bg-mustard":"bg-coral"),children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 scale-0 group-hover:scale-150 transition-transform rounded-full origin-center"}),e.jsxs("div",{className:"flex flex-col items-center relative z-10",children:[e.jsx(te,{className:A("w-8 h-8 fill-current",h?.isLost&&"text-ink")}),e.jsx("span",{className:A("text-[0.6rem] font-black uppercase tracking-wide mt-1",h?.isLost&&"text-ink"),children:h?.isLost?"I'm Lost!":"Lost?"})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-6 z-10 pointer-events-none",children:e.jsx("div",{className:"max-w-2xl mx-auto pointer-events-auto",children:s&&e.jsx(ge,{sessionId:t,studentId:s,questions:c??[]})})})]})}function be({transcript:t}){const r=n.useRef(null);return n.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[t]),e.jsxs("div",{className:"flex flex-col gap-4 overflow-y-auto custom-scrollbar pr-2",style:{maxHeight:"calc(100vh - 250px)"},children:[t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 opacity-50",children:[e.jsx("div",{className:"w-16 h-16 bg-white border-2 border-ink rounded-2xl mb-4 border-dashed"}),e.jsx("p",{className:"font-bold text-slate-500",children:"Waiting for teacher..."})]}):t.map((s,o)=>e.jsxs(N.div,{initial:{opacity:0,y:10,scale:.98},animate:{opacity:1,y:0,scale:1},className:`p-5 rounded-2xl text-lg font-medium shadow-comic-sm border-2 border-ink max-w-[90%] relative ${o%2===0?"bg-white text-ink rounded-tl-none self-start ml-2":"bg-mustard/20 text-ink rounded-tr-none self-end mr-2"}`,children:[e.jsx("div",{className:`absolute top-0 w-4 h-4 border-t-2 border-ink bg-inherit ${o%2===0?"-left-[18px] border-r-2 rounded-tr-xl skew-x-[20deg]":"-right-[18px] border-l-2 rounded-tl-xl -skew-x-[20deg]"}`}),s.text]},s._id)),e.jsx("div",{ref:r})]})}function ge({sessionId:t,studentId:r,questions:s}){const[o,l]=n.useState(""),[i,f]=n.useState(!1),[g,w]=n.useState(!1),u=z(y.questions.askQuestion),h=n.useRef(null),d=async c=>{if(c.preventDefault(),!(!o.trim()||g)){w(!0);try{await u({sessionId:t,studentId:r,question:o.trim()}),l(""),f(!0)}catch(a){console.error("Failed to ask question:",a)}w(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(U,{children:i&&e.jsxs(N.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},className:"absolute bottom-20 left-4 right-4 bg-white border-2 border-ink rounded-[2rem] shadow-comic max-h-[60vh] flex flex-col overflow-hidden z-20",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b-2 border-ink bg-soft-purple/20",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"AI Assistant"]}),e.jsxs("button",{onClick:()=>f(!1),className:"p-1 hover:bg-black/10 rounded-full transition-colors",children:[e.jsx("div",{className:"w-6 h-1 bg-ink rotate-45 absolute mt-2.5"}),e.jsx("div",{className:"w-6 h-1 bg-ink -rotate-45 relative"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 bg-milk",ref:h,children:[s.map(c=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"bg-coral text-white px-4 py-2 rounded-2xl rounded-tr-sm text-sm font-bold border-2 border-ink shadow-comic-sm",children:c.question})}),e.jsx("div",{className:"flex justify-start",children:c.answer?e.jsxs("div",{className:"bg-white border-2 border-ink text-ink px-4 py-3 rounded-2xl rounded-tl-sm text-sm font-medium shadow-comic-sm max-w-[90%]",children:[e.jsx(P,{className:"w-3 h-3 text-soft-purple mb-1 fill-current"}),c.answer]}):e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold pl-2",children:[e.jsx(E,{className:"w-3 h-3 animate-spin"})," Thinking..."]})})]},c._id)),s.length===0&&e.jsx("div",{className:"text-center py-10 text-slate-400 font-bold",children:"Ask anything!"})]})]})}),e.jsxs("form",{onSubmit:d,className:"relative group",children:[e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-ink/50 group-focus-within:text-coral transition-colors",children:e.jsx(ie,{className:"w-6 h-6"})}),e.jsx("input",{type:"text",value:o,onFocus:()=>f(!0),onChange:c=>l(c.target.value),placeholder:"Ask a question...",className:"w-full pl-12 pr-14 py-4 bg-white border-2 border-ink rounded-2xl outline-none font-bold text-ink placeholder-ink/30 shadow-comic transition-all focus:translate-x-1 focus:translate-y-1 focus:shadow-none"}),e.jsx("button",{type:"submit",disabled:!o.trim(),className:"absolute right-3 top-3 bottom-3 aspect-square bg-ink text-white rounded-xl flex items-center justify-center disabled:opacity-20 transition-all hover:bg-coral active:scale-95",children:g?e.jsx(E,{className:"w-5 h-5 animate-spin"}):e.jsx(ae,{className:"w-5 h-5"})})]})]})}function q(t){return`quiz-submitted-${t}`}function we({quiz:t,studentId:r}){const[s,o]=n.useState(new Array(t.questions.length).fill(-1)),[l,i]=n.useState(!1),f=z(y.quizzes.submitQuiz),g=v(y.quizzes.hasStudentSubmitted,{quizId:t._id,studentId:r}),[w,u]=n.useState(()=>typeof window<"u"?sessionStorage.getItem(q(t._id))==="true":!1),h=g===!0||w,d=(a,x)=>{if(h)return;const m=[...s];m[a]=x,o(m)},c=async()=>{if(s.some(a=>a===-1)){alert("Please answer all questions");return}i(!0);try{await f({quizId:t._id,studentId:r,answers:s}),sessionStorage.setItem(q(t._id),"true"),u(!0)}catch(a){console.error(a)}i(!1)};return h?e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-ink/50 backdrop-blur-sm z-50 flex items-center justify-center p-6",children:e.jsxs(N.div,{initial:{scale:.9,rotate:-2},animate:{scale:1,rotate:0},className:"bg-white border-2 border-ink rounded-[2.5rem] p-10 max-w-sm w-full text-center shadow-comic",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 border-2 border-ink rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(de,{className:"w-10 h-10 text-green-600"})}),e.jsx("h2",{className:"text-3xl font-black text-ink mb-2",children:"You're Awesome!"}),e.jsx("p",{className:"text-slate-500 font-bold",children:"Responses sent."})]})}):e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-ink/20 backdrop-blur-md z-[100] flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs(N.div,{initial:{y:100},animate:{y:0},className:"bg-white border-2 border-ink rounded-[2rem] p-6 max-w-xl w-full shadow-comic my-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("span",{className:"inline-block px-4 py-1 bg-mustard border-2 border-ink font-black rounded-lg text-xs uppercase tracking-wider mb-3 shadow-comic-sm",children:"Pop Quiz"}),e.jsx("h2",{className:"text-3xl font-black text-ink",children:"Quick Check!"})]}),e.jsx("div",{className:"space-y-8",children:t.questions.map((a,x)=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-lg font-bold text-ink",children:[x+1,". ",a.prompt]}),e.jsx("div",{className:"space-y-3",children:a.choices.map((m,b)=>e.jsxs("button",{onClick:()=>d(x,b),className:`w-full text-left px-5 py-4 rounded-xl font-bold transition-all border-2 shadow-comic-sm hover:translate-x-[2px] hover:translate-y-[2px] hover:shadow-none ${s[x]===b?"border-ink bg-coral text-white":"border-ink bg-white text-slate-600 hover:bg-gray-50"}`,children:[e.jsxs("span",{className:`inline-block w-8 ${s[x]===b?"opacity-100":"opacity-40"}`,children:[String.fromCharCode(65+b),"."]}),m]},b))})]},x))}),e.jsx("button",{onClick:c,disabled:l||s.some(a=>a===-1),className:"w-full mt-8 py-4 bg-ink hover:bg-slate-800 text-white font-black text-lg rounded-2xl shadow-comic transition-all disabled:opacity-50 disabled:shadow-comic-sm btn-press",children:l?"Sending...":"Submit Answers"})]})})}export{Ce as component};
