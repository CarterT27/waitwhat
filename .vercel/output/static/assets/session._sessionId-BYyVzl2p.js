import{r as n,j as e,R as K,u as O,c as S,a as A}from"./main-BM7h0QlO.js";import{a as j,L as $}from"./loader-circle-BatcI05A.js";import{c as R}from"./createLucideIcon-Bus0GVj8.js";import{M as U,i as V,u as q,P as G,a as B,b as X,L as Y,m as v}from"./proxy-CdFSLJal.js";import{S as L}from"./sparkles-MP49oUuu.js";const Z=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],J=R("circle-alert",Z);const ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],te=R("circle-check",ee);const se=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],ne=R("message-circle",se);const re=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ie=R("send",re);const oe=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],ae=R("thumbs-up",oe);function P(t,r){if(typeof t=="function")return t(r);t!=null&&(t.current=r)}function le(...t){return r=>{let s=!1;const o=t.map(l=>{const i=P(l,r);return!s&&typeof i=="function"&&(s=!0),i});if(s)return()=>{for(let l=0;l<o.length;l++){const i=o[l];typeof i=="function"?i():P(t[l],null)}}}}function ce(...t){return n.useCallback(le(...t),t)}class de extends n.Component{getSnapshotBeforeUpdate(r){const s=this.props.childRef.current;if(s&&r.isPresent&&!this.props.isPresent){const o=s.offsetParent,l=V(o)&&o.offsetWidth||0,i=this.props.sizeRef.current;i.height=s.offsetHeight||0,i.width=s.offsetWidth||0,i.top=s.offsetTop,i.left=s.offsetLeft,i.right=l-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function ue({children:t,isPresent:r,anchorX:s,root:o}){const l=n.useId(),i=n.useRef(null),u=n.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:p}=n.useContext(U),b=t.props?.ref??t?.ref,m=ce(i,b);return n.useInsertionEffect(()=>{const{width:g,height:d,top:a,left:c,right:h}=u.current;if(r||!i.current||!g||!d)return;const w=s==="left"?`left: ${c}`:`right: ${h}`;i.current.dataset.motionPopId=l;const x=document.createElement("style");p&&(x.nonce=p);const C=o??document.head;return C.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${l}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${d}px !important;
            ${w}px !important;
            top: ${a}px !important;
          }
        `),()=>{C.contains(x)&&C.removeChild(x)}},[r]),e.jsx(de,{isPresent:r,childRef:i,sizeRef:u,children:n.cloneElement(t,{ref:m})})}const me=({children:t,initial:r,isPresent:s,onExitComplete:o,custom:l,presenceAffectsLayout:i,mode:u,anchorX:p,root:b})=>{const m=q(fe),g=n.useId();let d=!0,a=n.useMemo(()=>(d=!1,{id:g,initial:r,isPresent:s,custom:l,onExitComplete:c=>{m.set(c,!0);for(const h of m.values())if(!h)return;o&&o()},register:c=>(m.set(c,!1),()=>m.delete(c))}),[s,m,o]);return i&&d&&(a={...a}),n.useMemo(()=>{m.forEach((c,h)=>m.set(h,!1))},[s]),n.useEffect(()=>{!s&&!m.size&&o&&o()},[s]),u==="popLayout"&&(t=e.jsx(ue,{isPresent:s,anchorX:p,root:b,children:t})),e.jsx(G.Provider,{value:a,children:t})};function fe(){return new Map}const z=t=>t.key||"";function Q(t){const r=[];return n.Children.forEach(t,s=>{n.isValidElement(s)&&r.push(s)}),r}const H=({children:t,custom:r,initial:s=!0,onExitComplete:o,presenceAffectsLayout:l=!0,mode:i="sync",propagate:u=!1,anchorX:p="left",root:b})=>{const[m,g]=B(u),d=n.useMemo(()=>Q(t),[t]),a=u&&!m?[]:d.map(z),c=n.useRef(!0),h=n.useRef(d),w=q(()=>new Map),x=n.useRef(new Set),[C,F]=n.useState(d),[k,M]=n.useState(d);X(()=>{c.current=!1,h.current=d;for(let y=0;y<k.length;y++){const f=z(k[y]);a.includes(f)?(w.delete(f),x.current.delete(f)):w.get(f)!==!0&&w.set(f,!1)}},[k,a.length,a.join("-")]);const I=[];if(d!==C){let y=[...d];for(let f=0;f<k.length;f++){const N=k[f],E=z(N);a.includes(E)||(y.splice(f,0,N),I.push(N))}return i==="wait"&&I.length&&(y=I),M(Q(y)),F(d),null}const{forceRender:W}=n.useContext(Y);return e.jsx(e.Fragment,{children:k.map(y=>{const f=z(y),N=u&&!m?!1:d===k||a.includes(f),E=()=>{if(x.current.has(f))return;if(x.current.add(f),w.has(f))w.set(f,!0);else return;let _=!0;w.forEach(D=>{D||(_=!1)}),_&&(W?.(),M(h.current),u&&g?.(),o&&o())};return e.jsx(me,{isPresent:N,initial:!c.current||s?void 0:!1,custom:r,presenceAffectsLayout:l,mode:i,root:b,onExitComplete:N?void 0:E,anchorX:p,children:y},f)})})};function ke(){const{sessionId:t}=K.useParams(),r=O(),[s,o]=n.useState(null),[l,i]=n.useState(!1);n.useEffect(()=>{const a=sessionStorage.getItem(`studentId-${t}`);a&&o(a),i(!0)},[t]),n.useEffect(()=>{l&&!s&&r({to:"/join"})},[l,s,r]);const u=S(j.sessions.getSession,{sessionId:t}),p=S(j.transcripts.listTranscript,{sessionId:t}),b=S(j.quizzes.getActiveQuiz,{sessionId:t}),m=S(j.questions.listRecentQuestions,{sessionId:t}),g=A(j.lostEvents.markLost);if(!u)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-4 border-ink border-t-transparent rounded-full animate-spin"})});if(u.status==="ended")return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-[2rem] shadow-comic border-2 border-ink text-center max-w-md w-full",children:[e.jsx("div",{className:"w-20 h-20 bg-mustard/20 rounded-full flex items-center justify-center mx-auto mb-6 border-2 border-ink",children:e.jsx(te,{className:"w-10 h-10 text-ink"})}),e.jsx("h1",{className:"text-2xl font-black mb-2",children:"That's a wrap!"}),e.jsx("p",{className:"text-slate-500 font-bold",children:"The lecture has ended. Great work today."})]})});const d=async()=>{s&&await g({sessionId:t,studentId:s})};return e.jsxs("div",{className:"min-h-screen bg-lavender-bg flex flex-col relative overflow-hidden",children:[e.jsx(H,{children:b&&s&&e.jsx(pe,{quiz:b,studentId:s})}),e.jsxs("div",{className:"flex-1 max-w-2xl mx-auto w-full p-4 pb-32 flex flex-col gap-6",children:[e.jsxs("header",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"bg-white border-2 border-ink rounded-full px-4 py-2 shadow-comic-sm flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-coral rounded-full animate-pulse border border-ink"}),e.jsx("span",{className:"font-bold text-sm tracking-wide",children:"LIVE SESSION"})]}),e.jsxs("div",{className:"font-mono font-bold text-ink/50 text-sm",children:["#",u.code]})]}),e.jsx("div",{className:"flex-1 min-h-0 flex flex-col gap-4",children:e.jsx(he,{transcript:p??[]})})]}),e.jsx("div",{className:"fixed bottom-24 right-6 z-20",children:e.jsxs(v.button,{whileHover:{scale:1.1,rotate:5},whileTap:{scale:.9},onClick:d,className:"w-20 h-20 bg-coral rounded-full shadow-comic flex items-center justify-center text-white border-2 border-ink active:shadow-comic-sm transition-all relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 scale-0 group-hover:scale-150 transition-transform rounded-full origin-center"}),e.jsxs("div",{className:"flex flex-col items-center relative z-10",children:[e.jsx(J,{className:"w-8 h-8 fill-current"}),e.jsx("span",{className:"text-[0.6rem] font-black uppercase tracking-wide mt-1",children:"Lost?"})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-6 z-10 pointer-events-none",children:e.jsx("div",{className:"max-w-2xl mx-auto pointer-events-auto",children:s&&e.jsx(xe,{sessionId:t,studentId:s,questions:m??[]})})})]})}function he({transcript:t}){const r=n.useRef(null);return n.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[t]),e.jsxs("div",{className:"flex flex-col gap-4 overflow-y-auto custom-scrollbar pr-2",style:{maxHeight:"calc(100vh - 250px)"},children:[t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 opacity-50",children:[e.jsx("div",{className:"w-16 h-16 bg-white border-2 border-ink rounded-2xl mb-4 border-dashed"}),e.jsx("p",{className:"font-bold text-slate-500",children:"Waiting for teacher..."})]}):t.map((s,o)=>e.jsxs(v.div,{initial:{opacity:0,y:10,scale:.98},animate:{opacity:1,y:0,scale:1},className:`p-5 rounded-2xl text-lg font-medium shadow-comic-sm border-2 border-ink max-w-[90%] relative ${o%2===0?"bg-white text-ink rounded-tl-none self-start ml-2":"bg-mustard/20 text-ink rounded-tr-none self-end mr-2"}`,children:[e.jsx("div",{className:`absolute top-0 w-4 h-4 border-t-2 border-ink bg-inherit ${o%2===0?"-left-[18px] border-r-2 rounded-tr-xl skew-x-[20deg]":"-right-[18px] border-l-2 rounded-tl-xl -skew-x-[20deg]"}`}),s.text]},s._id)),e.jsx("div",{ref:r})]})}function xe({sessionId:t,studentId:r,questions:s}){const[o,l]=n.useState(""),[i,u]=n.useState(!1),[p,b]=n.useState(!1),m=A(j.questions.askQuestion),g=n.useRef(null),d=async a=>{if(a.preventDefault(),!(!o.trim()||p)){b(!0);try{await m({sessionId:t,studentId:r,question:o.trim()}),l(""),u(!0)}catch(c){console.error("Failed to ask question:",c)}b(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(H,{children:i&&e.jsxs(v.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},className:"absolute bottom-20 left-4 right-4 bg-white border-2 border-ink rounded-[2rem] shadow-comic max-h-[60vh] flex flex-col overflow-hidden z-20",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b-2 border-ink bg-soft-purple/20",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"AI Assistant"]}),e.jsxs("button",{onClick:()=>u(!1),className:"p-1 hover:bg-black/10 rounded-full transition-colors",children:[e.jsx("div",{className:"w-6 h-1 bg-ink rotate-45 absolute mt-2.5"}),e.jsx("div",{className:"w-6 h-1 bg-ink -rotate-45 relative"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 bg-milk",ref:g,children:[s.map(a=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"bg-coral text-white px-4 py-2 rounded-2xl rounded-tr-sm text-sm font-bold border-2 border-ink shadow-comic-sm",children:a.question})}),e.jsx("div",{className:"flex justify-start",children:a.answer?e.jsxs("div",{className:"bg-white border-2 border-ink text-ink px-4 py-3 rounded-2xl rounded-tl-sm text-sm font-medium shadow-comic-sm max-w-[90%]",children:[e.jsx(L,{className:"w-3 h-3 text-soft-purple mb-1 fill-current"}),a.answer]}):e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold pl-2",children:[e.jsx($,{className:"w-3 h-3 animate-spin"})," Thinking..."]})})]},a._id)),s.length===0&&e.jsx("div",{className:"text-center py-10 text-slate-400 font-bold",children:"Ask anything!"})]})]})}),e.jsxs("form",{onSubmit:d,className:"relative group",children:[e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-ink/50 group-focus-within:text-coral transition-colors",children:e.jsx(ne,{className:"w-6 h-6"})}),e.jsx("input",{type:"text",value:o,onFocus:()=>u(!0),onChange:a=>l(a.target.value),placeholder:"Ask a question...",className:"w-full pl-12 pr-14 py-4 bg-white border-2 border-ink rounded-2xl outline-none font-bold text-ink placeholder-ink/30 shadow-comic transition-all focus:-translate-y-1 focus:shadow-comic-hover"}),e.jsx("button",{type:"submit",disabled:!o.trim(),className:"absolute right-3 top-3 bottom-3 aspect-square bg-ink text-white rounded-xl flex items-center justify-center disabled:opacity-20 transition-all hover:bg-coral active:scale-95",children:p?e.jsx($,{className:"w-5 h-5 animate-spin"}):e.jsx(ie,{className:"w-5 h-5"})})]})]})}function T(t){return`quiz-submitted-${t}`}function pe({quiz:t,studentId:r}){const[s,o]=n.useState(new Array(t.questions.length).fill(-1)),[l,i]=n.useState(!1),u=A(j.quizzes.submitQuiz),p=S(j.quizzes.hasStudentSubmitted,{quizId:t._id,studentId:r}),[b,m]=n.useState(()=>typeof window<"u"?sessionStorage.getItem(T(t._id))==="true":!1),g=p===!0||b,d=(c,h)=>{if(g)return;const w=[...s];w[c]=h,o(w)},a=async()=>{if(s.some(c=>c===-1)){alert("Please answer all questions");return}i(!0);try{await u({quizId:t._id,studentId:r,answers:s}),sessionStorage.setItem(T(t._id),"true"),m(!0)}catch(c){console.error(c)}i(!1)};return g?e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-ink/50 backdrop-blur-sm z-50 flex items-center justify-center p-6",children:e.jsxs(v.div,{initial:{scale:.9,rotate:-2},animate:{scale:1,rotate:0},className:"bg-white border-2 border-ink rounded-[2.5rem] p-10 max-w-sm w-full text-center shadow-comic",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 border-2 border-ink rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(ae,{className:"w-10 h-10 text-green-600"})}),e.jsx("h2",{className:"text-3xl font-black text-ink mb-2",children:"You're Awesome!"}),e.jsx("p",{className:"text-slate-500 font-bold",children:"Responses sent."})]})}):e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-ink/20 backdrop-blur-md z-[100] flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs(v.div,{initial:{y:100},animate:{y:0},className:"bg-white border-2 border-ink rounded-[2rem] p-6 max-w-xl w-full shadow-comic my-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("span",{className:"inline-block px-4 py-1 bg-mustard border-2 border-ink font-black rounded-lg text-xs uppercase tracking-wider mb-3 shadow-comic-sm",children:"Pop Quiz"}),e.jsx("h2",{className:"text-3xl font-black text-ink",children:"Quick Check!"})]}),e.jsx("div",{className:"space-y-8",children:t.questions.map((c,h)=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-lg font-bold text-ink",children:[h+1,". ",c.prompt]}),e.jsx("div",{className:"space-y-3",children:c.choices.map((w,x)=>e.jsxs("button",{onClick:()=>d(h,x),className:`w-full text-left px-5 py-4 rounded-xl font-bold transition-all border-2 shadow-comic-sm hover:translate-y-[-2px] hover:shadow-comic ${s[h]===x?"border-ink bg-coral text-white":"border-ink bg-white text-slate-600 hover:bg-gray-50"}`,children:[e.jsxs("span",{className:`inline-block w-8 ${s[h]===x?"opacity-100":"opacity-40"}`,children:[String.fromCharCode(65+x),"."]}),w]},x))})]},h))}),e.jsx("button",{onClick:a,disabled:l||s.some(c=>c===-1),className:"w-full mt-8 py-4 bg-ink hover:bg-slate-800 text-white font-black text-lg rounded-2xl shadow-comic transition-all disabled:opacity-50 disabled:shadow-comic-sm hover:-translate-y-1 hover:shadow-comic-hover",children:l?"Sending...":"Submit Answers"})]})})}export{ke as component};
